"use strict";!function(){function e(e,i){i=i||{};var o=i.CellRenderer;if(!o||"string"==typeof o){var n=o||e.behavior.getActiveColumn(0).getCellProperty(0,"renderer"),a=e.cellRenderers.get(n);o=Object.getPrototypeOf(a).constructor}var l=o.extend(s,u),c=e.cellRenderers.add(l);Object.getOwnPropertyNames(i).forEach(function(e){c[e]=i[e]}),e.behavior.setHeaders=t,e.behavior.isColumnReorderable=r,e.behavior.dataModel.groupHeaderDelimiter=c.delimiter}function t(e){var t=Object.getPrototypeOf(this).setHeaders,r=this.grid.cellRenderers.get(s),i=r.delimiter;t.call(this,e);var o=this.columns.reduce(function(e,t){return Math.max(t.header.split(i).length,e)},0),n=this.grid.behavior.subgrids.lookup.header,a=4*o/3*this.grid.properties.defaultRowHeight;this.grid.setRowHeight(0,a,n),this.columns.forEach(function(e){e.properties.columnHeader.renderer=s})}function r(){var e=Object.getPrototypeOf(this).isColumnReorderable,t=e.call(this),r=this.grid.cellRenderers.get(s),i=r.delimiter;return t&&!this.columns.find(function(e){return e.getCellProperty(0,"renderer")===s&&e.header.indexOf(i)!==-1})}function i(e,t){function r(r){r in t&&(r in l.configStash?t[r]=l.configStash[r]:l.configStash[r]=t[r]);var i=l.config[r];"paintBackground"!==r&&"function"==typeof i&&(i=i.call(this,e,t)),l[r]=i}var i=this["super"].paint,o=t.dataCell.x,n=t.value.split(this.delimiter),a=n.length-1;if(0!==a&&0!==o||(this.groups=[]),a){var l,c=this.groups,s=t.bounds,u=Object.assign({},s),h={isColumnHovered:t.isColumnHovered,isSelected:t.isSelected,font:t.font,backgroundColor:t.backgroundColor};s.height/=n.length,t.prefillColor=null;for(var f=0,g=s.y;f<a;f++,g+=s.height){if(c[f]&&n[f]===c[f].value?(l=c[f],l.width+=t.lineWidth+u.width):(l=c[f]=c[f]||{},l.value=n[f],l.left=u.x,l.width=u.width,l.configStash={font:t.font,backgroundColor:t.backgroundColor},l.config=this.groupConfig[f%this.groupConfig.length],Object.keys(l.config).forEach(r)),s.x=l.left,s.y=g,s.width=l.width,Object.assign(t,l),l.value){this.groupIndex=f,this.groupCount=a,t.isColumnHovered=t.isSelected=!1,t.value=l.value,t.font="bold "+t.font,i.call(this,e,t);var p=t.paintBackground||this.paintBackground;if(p){if("function"!=typeof p&&(p=d[p],"function"!=typeof p))throw"Expected decorator function or name of registered decorator function.";p.call(this,e,t)}}Object.assign(t,l.configStash)}s.x=u.x,s.y=g,s.width=u.width,t.value=n[f],Object.assign(t,h)}i.call(this,e,t),a&&Object.assign(s,u)}function o(e,t){var r=t.bounds,i=e.createLinearGradient(r.x,r.y,r.x,r.y+r.height);(t.gradientStops||this.gradientStops).forEach(function(e){i.addColorStop.apply(i,e)}),e.cache.fillStyle=i,e.fillRect(r.x+2,r.y,r.width-3,r.height)}function n(e,t){var r=t.bounds,i=t.thickness||this.groupCount-this.groupIndex;e.cache.fillStyle=t.color,e.fillRect(r.x+3,r.y+r.height-i,r.width-6,i)}function a(e,t,r,i){var o,n,a,d;return e.fillStyle=t,t=e.fillStyle,e.fillStyle=e.cache.fillStyle,t=t.match(h),d=t[8],d?(o=parseInt(t[5],10),n=parseInt(t[6],10),a=parseInt(t[7],10)):(o=parseInt(t[2],16),n=parseInt(t[3],16),a=parseInt(t[4],16)),o=l(o,r),n=l(n,r),a=l(a,r),void 0!==i&&(d=i),void 0!==d?"rgba("+o+", "+n+", "+a+", "+d+")":"#"+c(o)+c(n)+c(a)}function l(e,t){return e+(255-e)*t}function c(e){var t=Math.round(e).toString(16);return e<16&&(t="0"+t),t}var d,s="GroupedHeader",u={paint:i,delimiter:"|",paintBackground:n,groupConfig:[{color:function(e,t){return a(e,t.color,.5)},gradientStops:function(e,t){return[[0,a(e,t.color,.5,0)],[1,a(e,t.color,.5,.35)]]}}]},h=/(^#([0-9a-f]{2,2})([0-9a-f]{2,2})([0-9a-f]{2,2})|rgba\((\d+),\s*(\d+),\s*(\d+),\s*([.\d]+)\))$/i;d={mixInTo:e,install:e,decorateBackgroundWithBottomBorder:n,decorateBackgroundWithLinearGradient:o,lighterColor:a},window.fin.Hypergrid.groupedHeader=d}();