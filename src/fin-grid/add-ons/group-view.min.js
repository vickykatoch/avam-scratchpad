"use strict";!function(){function e(e,t){var i="function"==typeof e;return i?e:e&&t}function t(e,t){this.grid=e,this.options=t||{}}function i(e,t,i){var o=e.call(this,t,i);return t.isUserDataArea&&this.getRow(t.y).hasChildren&&(o=this.grid.cellRenderers.get("EmptyCell")),o}t.prototype={constructor:t.prototype.constructor,name:"GroupView",fireSyntheticGroupsChangedEvent:function(){this.grid.canvas.dispatchEvent(new CustomEvent("fin-groups-changed",{detail:{groups:this.getGroups(),time:Date.now(),grid:this}}))},getGroups:function(){for(var e=this.grid.behavior.dataModel,t=e.schema,i=t.map(function(e){return e.name}),o=e.findDataSourceByType("groupviewer"),r=o.groupBys,n=[],l=0;l<r.length;l++){var a=t[r[l]+1].header;n.push({id:r[l],label:a,field:i})}return n},getAvailableGroups:function(){for(var e=this.grid.behavior.dataModel,t=e.schema,i=e.findDataSourceByType("groupviewer"),o=i.groupBys,r=[],n=0;n<t.length;n++)if(o.indexOf(n)===-1){var l=t[o[n]].header;r.push({id:n,label:l,field:l})}return r},setGroups:function(t){if(t=t||this.options.groups,!t)throw"Expected a group list.";var o=t.length,r=this.grid,n=r.behavior,l=n.dataModel;if(o){var a=window.fin.Hypergrid.analytics;n.setPipeline([e(this.options.includeFilter,a.DataSourceGlobalFilter),a.DataSourceGroupView,e(this.options.includeSorter,a.DataNodeGroupSorter)],{stash:"default",apply:!1})}var s=l.findDataSourceByType("groupviewer"),c=n.getColumnProperties(s.treeColumnIndex),u=r.properties;return s.setGroupBys(t),o&&(n.reindex(),this.defaultGetCell=l.getCell,l.getCell=i.bind(l,this.defaultGetCell)),n.createColumns(),n.changed(),this.fireSyntheticGroupsChangedEvent(),o?(this.editableWas=!!c.editable,c.editable=!1,this.cellSelectionWas=!!c.cellSelection,c.cellSelection=!1,this.checkboxOnlyRowSelectionsWas=u.checkboxOnlyRowSelections,u.checkboxOnlyRowSelections=!0):(c.editable=this.editableWas,c.cellSelection=this.cellSelectionWas,u.checkboxOnlyRowSelections=this.checkboxOnlyRowSelectionsWas,n.unstashPipeline(),r.behavior.dataModel.getCell=this.defaultGetCell),r.selectionModel.clear(),r.clearMouseDown(),o}},window.fin.Hypergrid.GroupView=t}();